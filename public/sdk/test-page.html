<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nexora Analytics SDK Test Page</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #1a1a2e;
      margin-bottom: 8px;
    }

    h2 {
      color: #333;
      font-size: 18px;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 2px solid #667eea;
    }

    .subtitle {
      color: #666;
      margin-bottom: 20px;
    }

    .api-key-input {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    input[type="text"], input[type="email"], input[type="tel"], textarea {
      flex: 1;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      background: #5a6fd6;
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    .button-secondary {
      background: #764ba2;
    }

    .button-secondary:hover {
      background: #6a4291;
    }

    .button-success {
      background: #22c55e;
    }

    .button-success:hover {
      background: #16a34a;
    }

    .button-warning {
      background: #f97316;
    }

    .button-warning:hover {
      background: #ea580c;
    }

    .button-danger {
      background: #ef4444;
    }

    .button-danger:hover {
      background: #dc2626;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #333;
    }

    .log-container {
      background: #1a1a2e;
      border-radius: 8px;
      padding: 16px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
    }

    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid #333;
      color: #fff;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .log-time {
      color: #667eea;
    }

    .log-type {
      color: #22c55e;
      font-weight: bold;
    }

    .log-data {
      color: #a0aec0;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-connected {
      background: #d1fae5;
      color: #059669;
    }

    .status-disconnected {
      background: #fee2e2;
      color: #dc2626;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .info-box {
      background: #e0e7ff;
      border-left: 4px solid #667eea;
      padding: 12px;
      border-radius: 0 8px 8px 0;
      margin-bottom: 16px;
    }

    .info-box p {
      color: #3730a3;
      font-size: 14px;
    }

    footer {
      text-align: center;
      padding: 20px;
      color: white;
    }

    footer a {
      color: #fff;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="card">
      <h1>üîç Nexora Analytics SDK Test Page</h1>
      <p class="subtitle">Test all tracking features: page views, events, forms, user identification, and more.</p>

      <div class="api-key-input">
        <input type="text" id="apiKey" placeholder="Enter your API key (e.g., nxa_abc123...)" />
        <button onclick="initializeSDK()">Initialize SDK</button>
      </div>

      <div id="status">
        <span class="status-badge status-disconnected">Not Initialized</span>
      </div>
    </div>

    <!-- Page Navigation Test -->
    <div class="card">
      <h2>üìÑ Page View Tracking</h2>
      <p class="info-box">
        <p>Page views are tracked automatically. Use manual tracking for SPA navigation.</p>
      </p>

      <div class="test-grid">
        <button onclick="trackPage('/home', 'Home Page')">Track /home</button>
        <button onclick="trackPage('/products', 'Products')" class="button-secondary">Track /products</button>
        <button onclick="trackPage('/pricing', 'Pricing')" class="button-success">Track /pricing</button>
        <button onclick="trackPage('/contact', 'Contact Us')" class="button-warning">Track /contact</button>
      </div>
    </div>

    <!-- Custom Events Test -->
    <div class="card">
      <h2>üéØ Custom Event Tracking</h2>
      <p class="info-box">
        <p>Track custom events with any properties you need.</p>
      </p>

      <div class="test-grid">
        <button onclick="trackEvent('button_click', { label: 'CTA Button', position: 'header' })">
          Button Click
        </button>
        <button onclick="trackEvent('video_play', { videoId: 'intro-video', duration: 120 })" class="button-secondary">
          Video Play
        </button>
        <button onclick="trackEvent('file_download', { filename: 'brochure.pdf', size: '2.5MB' })" class="button-success">
          File Download
        </button>
        <button onclick="trackEvent('add_to_cart', { productId: 'SKU123', price: 99.99 })" class="button-warning">
          Add to Cart
        </button>
        <button onclick="trackEvent('purchase', { orderId: 'ORD-001', total: 199.99, items: 2 })" class="button-danger">
          Purchase
        </button>
        <button onclick="trackEvent('newsletter_signup', { source: 'footer' })">
          Newsletter Signup
        </button>
      </div>
    </div>

    <!-- User Identification -->
    <div class="card">
      <h2>üë§ User Identification</h2>
      <p class="info-box">
        <p>Link anonymous visitors to known users in your CRM.</p>
      </p>

      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="identifyEmail" placeholder="user@example.com" />
      </div>
      <div class="form-group">
        <label>First Name</label>
        <input type="text" id="identifyFirstName" placeholder="John" />
      </div>
      <div class="form-group">
        <label>Last Name</label>
        <input type="text" id="identifyLastName" placeholder="Doe" />
      </div>
      <div class="form-group">
        <label>Company</label>
        <input type="text" id="identifyCompany" placeholder="Acme Inc." />
      </div>

      <button onclick="identifyUser()">Identify User</button>
    </div>

    <!-- Form Submission Test -->
    <div class="card">
      <h2>üìù Form Submission Tracking</h2>
      <p class="info-box">
        <p>Forms are tracked automatically. Submit this form to test.</p>
      </p>

      <form id="testForm" onsubmit="handleFormSubmit(event)">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" name="fullName" placeholder="Your name" required />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" name="email" placeholder="your@email.com" required />
        </div>
        <div class="form-group">
          <label>Phone</label>
          <input type="tel" name="phone" placeholder="+1 234 567 890" />
        </div>
        <div class="form-group">
          <label>Message</label>
          <textarea name="message" rows="3" placeholder="Your message..."></textarea>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" name="subscribe" id="subscribe" />
          <label for="subscribe">Subscribe to newsletter</label>
        </div>
        <button type="submit" class="button-success">Submit Form</button>
      </form>
    </div>

    <!-- Consent Management -->
    <div class="card">
      <h2>üîí Consent Management</h2>
      <p class="info-box">
        <p>Test GDPR-compliant consent controls.</p>
      </p>

      <div class="test-grid">
        <button onclick="setConsent(true)" class="button-success">Grant Consent</button>
        <button onclick="setConsent(false)" class="button-warning">Revoke Consent</button>
        <button onclick="optOut()" class="button-danger">Opt Out Completely</button>
      </div>
    </div>

    <!-- Click Tracking Test -->
    <div class="card">
      <h2>üñ±Ô∏è Click Tracking Test</h2>
      <p class="info-box">
        <p>These elements have data-track attributes for automatic click tracking.</p>
      </p>

      <div class="test-grid">
        <button data-track="cta-primary" data-track-label="Primary CTA">
          Primary CTA
        </button>
        <button data-track="cta-secondary" data-track-label="Secondary CTA" class="button-secondary">
          Secondary CTA
        </button>
        <a href="#" data-track="nav-link" data-track-label="Navigation Link" onclick="event.preventDefault()">
          <button>Navigation Link</button>
        </a>
      </div>
    </div>

    <!-- Debug Log -->
    <div class="card">
      <h2>üìã Debug Log</h2>
      <button onclick="clearLog()" style="margin-bottom: 16px;" class="button-danger">Clear Log</button>
      <div class="log-container" id="logContainer">
        <div class="log-entry">
          <span class="log-time">[--:--:--]</span>
          <span class="log-data">Waiting for SDK initialization...</span>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>Nexora Analytics SDK Test Page | <a href="/analytics/tracking">Manage Tracking Scripts</a></p>
  </footer>

  <!-- Load the SDK -->
  <script src="./nexora-analytics.js"></script>

  <script>
    let isInitialized = false;

    function log(type, message, data = null) {
      const container = document.getElementById('logContainer');
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `
        <span class="log-time">[${time}]</span>
        <span class="log-type">${type}</span>
        <span class="log-data">${message}${data ? ' ' + JSON.stringify(data) : ''}</span>
      `;
      container.insertBefore(entry, container.firstChild);
    }

    function clearLog() {
      const container = document.getElementById('logContainer');
      container.innerHTML = '<div class="log-entry"><span class="log-time">[--:--:--]</span><span class="log-data">Log cleared</span></div>';
    }

    function updateStatus(connected) {
      const status = document.getElementById('status');
      status.innerHTML = connected
        ? '<span class="status-badge status-connected">‚úì SDK Initialized</span>'
        : '<span class="status-badge status-disconnected">Not Initialized</span>';
    }

    function initializeSDK() {
      const apiKey = document.getElementById('apiKey').value.trim();

      if (!apiKey) {
        alert('Please enter an API key');
        return;
      }

      try {
        NexoraAnalytics.init(apiKey, {
          trackPageViews: true,
          trackForms: true,
          trackClicks: true,
          trackScrollDepth: true,
          respectDNT: false, // Disable for testing
          debug: true
        });

        isInitialized = true;
        updateStatus(true);
        log('INIT', 'SDK initialized successfully with key:', apiKey.slice(0, 10) + '...');
      } catch (error) {
        log('ERROR', 'Failed to initialize SDK:', error.message);
      }
    }

    function trackPage(path, title) {
      if (!isInitialized) {
        log('WARN', 'SDK not initialized. Please initialize first.');
        return;
      }

      try {
        NexoraAnalytics.page(path, { title });
        log('PAGE', `Tracked page view: ${path}`, { title });
      } catch (error) {
        log('ERROR', 'Failed to track page:', error.message);
      }
    }

    function trackEvent(eventName, properties) {
      if (!isInitialized) {
        log('WARN', 'SDK not initialized. Please initialize first.');
        return;
      }

      try {
        NexoraAnalytics.track(eventName, properties);
        log('EVENT', `Tracked event: ${eventName}`, properties);
      } catch (error) {
        log('ERROR', 'Failed to track event:', error.message);
      }
    }

    function identifyUser() {
      if (!isInitialized) {
        log('WARN', 'SDK not initialized. Please initialize first.');
        return;
      }

      const email = document.getElementById('identifyEmail').value;
      const firstName = document.getElementById('identifyFirstName').value;
      const lastName = document.getElementById('identifyLastName').value;
      const company = document.getElementById('identifyCompany').value;

      if (!email) {
        alert('Email is required for identification');
        return;
      }

      try {
        const traits = { email, firstName, lastName, company };
        NexoraAnalytics.identify(traits);
        log('IDENTIFY', 'User identified:', traits);
      } catch (error) {
        log('ERROR', 'Failed to identify user:', error.message);
      }
    }

    function handleFormSubmit(event) {
      event.preventDefault();

      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData.entries());

      log('FORM', 'Form submitted (auto-tracked):', data);

      // Reset form
      event.target.reset();
      alert('Form submitted! Check the debug log.');
    }

    function setConsent(granted) {
      if (!isInitialized) {
        log('WARN', 'SDK not initialized. Please initialize first.');
        return;
      }

      try {
        NexoraAnalytics.setConsent(granted);
        log('CONSENT', granted ? 'Consent granted' : 'Consent revoked');
      } catch (error) {
        log('ERROR', 'Failed to set consent:', error.message);
      }
    }

    function optOut() {
      if (!isInitialized) {
        log('WARN', 'SDK not initialized. Please initialize first.');
        return;
      }

      try {
        NexoraAnalytics.optOut();
        log('OPT_OUT', 'User opted out of tracking');
      } catch (error) {
        log('ERROR', 'Failed to opt out:', error.message);
      }
    }

    // Log when page loads
    window.addEventListener('load', () => {
      log('INFO', 'Test page loaded. Enter your API key to begin testing.');
    });
  </script>
</body>
</html>
